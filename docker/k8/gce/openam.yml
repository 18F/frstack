---
# Configure OpenAM on base image
# This assumes openam is running
# todo: Second server install needs to be fixed
# Use existingserverid
# http://docs.forgerock.org/en/openam/12.0.0/reference/index/man-configurator-jar-1.html

- hosts: localhost
  connection: local
  tasks:
  - name: Configure Primary OpenAM instance
    ssoconfigure: server_url="{{item}}"
      deployment_uri="/openam"
      base_dir="/root/openam"
      directory_server="opendj"
      root_suffix="dc=example,dc=com"
      directory_admin_port="4444"
      directory_jmx_port="1689"
      directory_port="389"
      ds_dirmgrdn="cn=Directory Manager"
      data_store="dirServer"
      ds_dirmgrpasswd="password"
      amldapuserpasswd="Passw0rd"
      userstore_type="LDAPv3ForOpenDS"
      userstore_ssl="SIMPLE"
      userstore_host="opendj"
      userstore_port="389"
      userstore_mgrdn="cn=Directory Manager"
      userstore_passwd="password"
      userstore_suffix="dc=example,dc=com"
      cookie_domain=".example.com"
      admin_pwd="password"
      acceptlicense="true"
      am_enc_key="AQICY6Za5J5noktyqnhW10JiPVNUdKuiZYwS"
      lb_site_name="site1"
      lb_primary_url="http://openam.example.com:80/openam"
      lb_session_ha_sfo="true"
    with_items:
      - http://openam-svc-a:80/
      - http://openam-svc-b:80/
      #- http://openam-a.example.com/
      #- http://openam-b.example.com/


